---
title: IPアドレスの履歴テーブルに処理済みの項目を追加
date: 2020-06-07
---

[GLIPAH](https://glipah.netlify.app/)サイトのIPアドレスの一覧表に処理済みのフィールドを追加します。
処理済みのフィールドは、新しいIPアドレスが割り当てられたときに必要な設定、たとえばGoogleアナリティクスのフィルターへの追加などを
完了した場合にチェックすることで、処理漏れを防ぎます。

<style>
table {
  margin-left: auto;
  margin-right: auto;
  margin-top: 1em;
  border-collapse: collapse;
}
td,
th {
  border: 1px solid;
  margin: 0;
  padding: 0.2em 3em;
}
</style>

<table>
  <thead>
    <tr>
      <th>IPアドレス</th>
      <th>アクセス回数</th>
      <th>初回のアクセス日時</th>
      <th>最新のアクセス日時</th>
      <th>処理済み</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>xx.xx.xx.xx</td>
      <td>29</td>
      <td>2020/05/01 09:17:54</td>
      <td>2020/05/31 21:18:18</td>
      <td>□</td>
    </tr>
    <tr>
      <td>yy.yy.yy.yy</td>
      <td>23</td>
      <td>2020/04/01 11:46:17</td>
      <td>2020/04/29 10:25:38</td>
      <td>■</td>
    </tr>
  </tbody>
</table>

<!--more-->

## データベースの変更

accessストアに加えて、IPアドレスごとの処理済みかどうかを記録するprocessストアを定義します。processストアの主キーはIPアドレスを保存するipAddressで、他に処理済みかどうかを保存するprocessedフィールドがあります。

## 影響するテストをスキップ

一覧表をHTMLレベルで確認するテストは修正が一区切りするまでエラーになるため、スキップさせます。

## テストケースの見直し

一覧表の修正にあわせて、テストケースを見直します。

### 従来のテストの修正

従来のテストは、処理済みのフィールドがすべてオフである確認を追加します。

### テストケースの追加

以下を場合ごとのテストケースを追加します。前提は[IPアドレスの一覧表の形式を修正 \- 思いつきを書くブログ](https://omoitsuki.netlify.app/posts/table/)の[テストケース10](https://omoitsuki.netlify.app/posts/table#ケース10)とします。

1. 11.22.33.44の処理済みフィールドをチェックする
1. ab.cd.ef.ghの処理済みフィールドをチェックする
1. 11.22.33.44の処理済みフィールドをチェックした後に、チェックを解除する
1. ab.cd.ef.ghの処理済みフィールドをチェックした後に、チェックを解除する

それぞれの場合のテスト項目です。

1. チェックする場合、チェックを解除する場合に、正しいメソッドが正しい引数で呼び出される
1. チェックする場合、チェックを解除する場合に、IndexedDBに正しく保存される
1. チェックする場合、チェックを解除する場合に、画面に正しく反映される
